<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Particulate Matter Data</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <div class="title-container">
            <h1>Particulate Matter Data</h1>
            <form action="export.php" method="post">
                <input type="submit" value="Export to Excel">
            </form>
            <form action="set-location.html" method="get">
                <input type="submit" value="Update Locations">
            </form>
        </div>
        <table>
            <tr>
                <th>No.</th>
                <th>Timestamp</th>
                <th>Device ID</th>
                <th>Location</th> <!-- Add Location header -->
                <th>PM2.5</th>
                <th>PM2.5 Remarks</th>
                <th>PM10</th>
                <th>PM10 Remarks</th>
            </tr>
            <tbody id="data-body">
                <!-- Data will be dynamically populated here -->
            </tbody>
        </table>
        <br>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function() {
            const apiUrl = "https://phlhxvertmsqskgofbug.supabase.co/rest/v1/tblparticulate_matter";
            const apiKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBobGh4dmVydG1zcXNrZ29mYnVnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MTk5OTgyMjMsImV4cCI6MjAzNTU3NDIyM30.K-byE_UrblXBVqxyqvwSN_LVlOuyBi2b3XruZaAV6P8";

            fetch(apiUrl, {
                headers: {
                    'apikey': apiKey,
                    'Authorization': `Bearer ${apiKey}`,
                    'Content-Type': 'application/json',
                    'Accept': 'application/json'
                }
            })
            .then(response => response.json())
            .then(data => {
                let html = '';
                if (data.length > 0) {
                    data.forEach((row, index) => {
                        html += `
                            <tr>
                                <td>${index + 1}</td>
                                <td>${row.timestamp}</td>
                                <td>${row.device_id}</td>
                                <td>${row.location}</td>
                                <td>${row.pm25}</td>
                                <td>${row.pm25remarks}</td>
                                <td>${row.pm10}</td>
                                <td>${row.pm10remarks}</td>
                            </tr>
                        `;
                    });
                } else {
                    html += `<tr><td colspan="8">No results</td></tr>`;
                }
                document.getElementById('data-body').innerHTML = html;
            })
            .catch(error => {
                console.error('Error fetching data:', error);
                document.getElementById('data-body').innerHTML = `<tr><td colspan="8">Error fetching data</td></tr>`;
            });
        });
    </script>
</body>
</html>
